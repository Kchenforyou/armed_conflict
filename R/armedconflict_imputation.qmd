---
title: "Armed Conflict Imputation"
format: html
editor: visual
---

## Models

Import Libraries

```{r}
#|output = false
#|echo = false
library(tidyverse)
library(xtable)
library(readr)
library(stargazer)
library(mice)
# library(plm)

```

Import Armed Conflict Data Set and Log Transform GDP

```{r}
#|echo = false
final_dat <- read_csv("../data/armed_conflict.csv")
final_dat <- final_dat[-1]
final_dat$gdp1000 <- log(final_dat$gdp1000 + 1)
is.na(final_dat) <- sapply(final_dat, is.infinite)
# final_dat <- final_dat %>% mutate_all(~replace(., is.na(.), 0))
```

Imputation

```{r}
#|echo = false
#change ISO to numeric
midata <- final_dat |>
  mutate(ISOnum = as.numeric(as.factor(final_dat$ISO))) |>
  select(-country_name, -ISO)

# dry run
mice0  <- mice(midata, seed = 100, m = 5, maxit = 0, print = F)

meth <- mice0$method
meth[c("urban", "male_edu", "temp", "rainfall1000", "matmor", "infmor", "neomor", "under5mor", "gdp1000", "popdens")] <- "2l.lmer"

pred <- mice0$predictorMatrix
pred[c("urban", "male_edu", "temp", "rainfall1000", "matmor", "infmor", "neomor", "under5mor", "gdp1000", "popdens"), "ISOnum"] <- -2

# multiple imputation
mice.multi.out  <- mice(midata, seed = 100, m = 10, maxit = 20,
                        method = meth,
                        predictorMatrix = pred)

plot(mice.multi.out)
```



Models

```{r}
preds <- as.formula(" ~ armconf1 + gdp1000 + OECD + popdens + urban + 
                  agedep + male_edu + temp + rainfall1000 + earthquake + drought + 
                  ISO + as.factor(year)")

matmormod <- with(data = mice.multi.out, 
                  lm(update.formula(preds, matmor ~ .)))
un5mormod <- with(data = mice.multi.out, 
                  lm(update.formula(preds, under5mor ~ .)))
infmormod <- with(data = final_dat,
                  lm(update.formula(preds, infmor ~ .)))
neomormod <- with(data = mice.multi.out, 
                  lm(update.formula(preds, neomor ~ .)))
```

'Slice' out armed conflict data
```{r}
models <- list(matmormod, un5mormod, infmormod, neomormod)

# Extracting armconf1 coefficients
armed_conflict_coefs <- sapply(models, function(model){ coef(model)["armconf1"]})

# Create a data frame with "Yes" and "No" rows
armed_conflict_coefs <- t(data.frame(
  "No Armed Conflict" = rep(0, length(armed_conflict_coefs)),          # 0 for "No" rows
  "Yes Armed Conflict" = armed_conflict_coefs))                         # Coefficient for "Yes" rows

colnames(armed_conflict_coefs) <- c("Maternal Mortality",
                                "Under 5 Mortality",
                                "Infant Mortality",
                                "Neonatal Mortality") # Name columns by model
```

Combine the other covariates

```{r}
other_coefs <- as.data.frame(sapply(models, function(model){ coef(model)[-1]}))

colnames(other_coefs) <- c("Maternal Mortality",
                                     "Under 5 Mortality",
                                     "Infant Mortality",
                                     "Neonatal Mortality")

armed_conf_table <- rbind(armed_conflict_coefs, other_coefs)

```


```{r}
#|output = false
#|echo = false
# Use stargazer to display the table
s <- stargazer(armed_conf_table, type = "html", title = "Armed Conflict Binary for Mortality Models", out = c("Figures/mordmodel.html"), summary = FALSE, rownames = TRUE)
```
